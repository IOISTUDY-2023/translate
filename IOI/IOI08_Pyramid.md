# Pyramid Base(IOI 2008)
# 문제
당신은 새로운 피라미드를 건설하기 위해 가장 저렴한 장소를 찾아달라는 요청을 받았습니다.   
귀하의 결정을 돕기 위해 M x N 정사각형 셀 그리드로 편리하게 나누어진 사용 가능한 토지에 대한 조사가 제공되었습니다.   
피라미드의 밑면은 변이 평행한 정사각형이어야 합니다. 조사를 통해 P개의 중첩 가능성이 있는 장애물 세트가 식별되었으며, 이는 직사각형으로 표현됩니다.   
그리드의 측면과 평행한 측면을 가진 그리드. 피라미드를 건설하려면 피라미드의 바닥으로 덮인 모든 셀에 장애물을 제거해야 합니다.   
i번째 장애물을 제거하는데에 $C_i$원이 요구됩니다. 어떤 장애물을 제거하려면 완전히 제거해야 합니다.   
즉, 장애물의 일부만 제거할 수는 없습니다. 또한 장애물을 제거해도 장애물과 겹치는 다른 장애물에는 영향을 미치지 않습니다.   
토지의 가로길이와 세로길이 M과 N, 장애물의 개수 P, 각 장애물을 제거하는 데 드는 비용,
예산 B를 고려하여 피라미드 밑면의 가능한 최대 변 길이를 구하는 프로그램을 작성하십시오.
장애물을 제거하는 데 드는 총 비용은 B를 초과해선 안됩니다.  
# 제한과 채점
당신의 프로그램은 세 개의 독립된 테스트들의 집합에 대해 채점될 것입니다.   
그들 전체에 대해, 다음 조건이 성립합니다:   
$1\le M,N\le 1,000,000$   
$1\le C_i \le 7,000$   
$1\le X_{i1}\le X_{i2}\le M$   
$1\le Y_{i1}\le Y_{i2}\le N$   
   
첫 테스트의 집합에는 35점이 부여되어 있습니다:   
$B=0$   
$1\le P\le 1,000$   
두번째 테스트의 집합에는 35점이 부여되어 있습니다:   
$0\lt B\le 2,000,000,000$   
$1\le P\le 30,000$   
세번째 테스트의 집합에는 30점이 부여되어 있습니다:   
$B=0$   
$1\le P\le 400000$   
# 입력
프로그램은 표준 입력에서 다음 데이터를 읽어야 합니다.   
   
1행에는 각각 M과 N을 나타내는 단일 공백으로 구분된 두 개의 정수가 포함되어 있습니다.   
두 번째 줄에는 감당할 수 있는 최대 비용(예: 예산)인 정수 B가 포함됩니다.   
3행에는 조사에서 발견된 장애물의 수인 정수 P가 포함됩니다.   
다음 P 라인 각각은 장애물을 설명합니다. 이 선 중 i번째는 i번째 장애물을 나타냅니다.   
각 줄은 단일 공백으로 구분된 5개의 정수 $(X_{i1}, Y_{i1}, X_{i2}, Y_{i2},C_i)$로 구성됩니다.   
이는 각각 장애물의 가장 왼쪽 셀의 좌표, 장애물의 가장 오른쪽 셀의 좌표,   
장애물 제거 비용을 나타냅니다. 그리드의 맨 아래 가장 왼쪽 셀에는 좌표 (1, 1)가 있고   
맨 위 맨 오른쪽 셀에는 좌표 (M, N)가 있습니다.    
# 출력
준비할 수 있는 피라미드 밑면의 가능한 측면 길이의 최대값을 포함하는
하나의 정수를 출력하십시오.
피라미드의 건축이 불가능한 경우 프로그램은 숫자 0을 출력해야 합니다. 
## 예제

### 예제 입력 1
```
6 9 
42 
5 
4 1 6 3 12 
3 6 5 6 9 
1 3 3 8 24 
3 8 6 9 21 
5 1 6 2 20 
```
### 예제 출력 1
```
4
```
### 설명
해당 그림은 변의 길이가 4로 가능한 두 개의 피라미드 기반의 위치를 보여주고 있습니다.  
### 예제 입력 2
```
13 5 
0 
8 
8 4 10 4 1 
4 3 4 4 1 
10 2 12 2 2 
8 2 8 4 3 
2 4 6 4 5 
10 3 10 4 8 
12 3 12 4 13 
2 2 4 2 21 
```
### 예제 출력 2
```
3
```
### 설명
해당 그림은 변의 길이가 3으로 가능한 유일한 피라미드 기반의 위치를 보여주고 있습니다.
+ ## Subtask 1. ( $35점$)
그 어떤 장애물도 제거할 수 없는 케이스입니다.
잘 생각해보면, 가능한 가장 큰 피라미드들은 적어도 좌우중 한 쪽이 장애물, 혹은 
전체 공간의 가장자리와 접해있고 이는 위 아래에 대해서도 마찬가지임을 알 수 있습니다. 이 성질을
자명하게 적용하면 가능한 모든 왼쪽, 오른쪽, 위, 아래에 대해서 가능한 최대 정사각형을 판별하는
문제가 되기 때문에 $O(P^3)$정도의 시간복잡도를 가지게 됩니다.
조금 더 생각해보면, 결정문제를 통해 해당 문제를 조금 더 빠르게 풀 수 있습니다.
기본적으로 길이 l이 되는 정사각형이 존재한다면 그보다 작은 길이의 정사각형도 존재하기 때문입니다.
또한, 길이 l의 정사각형이 존재한다는 것을 다르게 표현하면, 현재 존재하는 모든 장애물들을
왼쪽, 아래쪽으로 l만큼 늘린 새로운 문제에서 빈 공간이 존재하는지로 치환할 수 있습니다.
빈 공간이 존재하는지를 판별하는 문제는 충분히 빠른 시간 내에 쉽게 해결될 수 있기 때문에,
전체 문제도 충분히 빠르게 해결할 수 있습니다.
+ ## Subtask 2. ( $70점$)
이번에는 어떤 장애물은 제거될 수 있는 경우입니다. 서브태스크 1의 풀이에서 착안하여,
장애물들을 가로세로로 늘린 뒤 판별문제를 해결하는 방식으로 문제를 풀 수 있는지 확인해봅시다.
일단 각 장애물들을 늘린 후, 장애물들이 전체 공간에서 점유하는 영역들은 사실 전체 공간의 가로축을 기반으로 스위핑을
해보면, 하나의 장애물을 두 개의 구간을 갱신하는 쿼리로 해석할 수 있습니다. 즉, x=0인 직선을 오른쪽으로 움직이면서
각 장애물들에 의해 영역들이 점유된 상태를 관리할 수 있습니다. 구간에 대해 장애물의 가중치를 더하거나, 빼는 연산들을 처리해야 하므로
최솟값 레이지 세그먼트 트리를 사용하면 빈 공간이 존재하는지 매 순간마다 빠르게 체크해줄 수 있고, 결과적으로 한 번의 판별 문제를
 $ O(nlogn) $정도에 해결해줄 수 있습니다. 따라서 전체 시간복잡도는 $ O(nlog^2n) $정도가 됩니다.
 + ## Subtask 3. ( $100점$)
 다시 어떤 장애물도 제거할 수 없는 케이스입니다. 로그제곱 풀이는 이 문제를 해결하기에 다소 느린 감이 없지 않아 있습니다. 로그 풀이를 생각해봅시다.   
 일단 첫번째로 관찰해야 하는 사실은, 어떤 정사각형의 왼쪽 모서리가 놓일 직선을 고정한 뒤, 최대한 큰 정사각형을 만들때 사용되는
 오른쪽 모서리를 연장한 직선을 생각해봅시다. 일종의 그리디적 관찰에 의해 왼쪽 직선이 오른쪽으로 이동함에 따라, 오른쪽 직선 또한 오른쪽으로 이동할 수 밖에 없습니다. 바로 직전의 오른쪽 직선과 현재 왼쪽 직선 사이에는 무조건 올바른 정사각형이 존재하기 때문입니다.   
 따라서 일종의 투포인터와 같이 각 직선들을 관리해주는 풀이를 구상해볼 수 있습니다.   
 그렇다면, 직선들을 이동시키면서 조건이 만족되는지를 확인하는 방법에는 어떠한 것이 있을까요? 이를 잘 생각해보면,
 특정한 구간에 값을 더하거나 빼는 쿼리가 주어질 때 모든 값이 0인 가장 긴 구간의 길이를 계산하는 문제가 됩니다.   
 세그먼트 트리를 통해 빠르게 해결할 수 있는데, 각 정점에 다음과 같은 값들을 저장한다고 생각해봅시다(x-구간길이는 x로 이루어진 구간의 길이를 뜻합니다):
 가장 긴 최솟값-구간 길기, 왼쪽에서 시작하는 최솟값-구간 길이, 오른쪽에서 시작하는 최솟값-구간 길이, 구간 내 최솟값   
   
 그렇다면, 두 노드를 합치는 연산을 빠르게 수행할 수 있음을 알 수 있고, 따라서 전체 구간에 대해서도 답을 빠르게 계산할 수 있습니다.   
 이 자료구조를 통해 투포인터를 진행해가며 매 순간 가장 큰 피라미드의 변의 길이를 알아내면 문제가 풀립니다.
