# Pyramid Base(IOI 2008)
# 문제
당신은 새로운 피라미드를 건설하기 위해 가장 저렴한 장소를 찾아달라는 요청을 받았습니다.   
귀하의 결정을 돕기 위해 M x N 정사각형 셀 그리드로 편리하게 나누어진 사용 가능한 토지에 대한 조사가 제공되었습니다.   
피라미드의 밑면은 변이 평행한 정사각형이어야 합니다. 조사를 통해 P개의 중첩 가능성이 있는 장애물 세트가 식별되었으며, 이는 직사각형으로 표현됩니다.   
그리드의 측면과 평행한 측면을 가진 그리드. 피라미드를 건설하려면 피라미드의 바닥으로 덮인 모든 셀에 장애물을 제거해야 합니다.   
i번째 장애물을 제거하는데에 $C_i$원이 요구됩니다. 어떤 장애물을 제거하려면 완전히 제거해야 합니다.   
즉, 장애물의 일부만 제거할 수는 없습니다. 또한 장애물을 제거해도 장애물과 겹치는 다른 장애물에는 영향을 미치지 않습니다.   
토지의 가로길이와 세로길이 M과 N, 장애물의 개수 P, 각 장애물을 제거하는 데 드는 비용,
예산 B를 고려하여 피라미드 밑면의 가능한 최대 변 길이를 구하는 프로그램을 작성하십시오.
장애물을 제거하는 데 드는 총 비용은 B를 초과해선 안됩니다.  
# 제한과 채점
당신의 프로그램은 세 개의 독립된 테스트들의 집합에 대해 채점될 것입니다.   
그들 전체에 대해, 다음 조건이 성립합니다:   
$1\le M,N\le 1,000,000$   
$1\le C_i \le 7,000$   
$1\le X_{i1}\le X_{i2}\le M$   
$1\le Y_{i1}\le Y_{i2}\le N$   
   
첫 테스트의 집합에는 35점이 부여되어 있습니다:   
$B=0$   
$1\le P\le 1,000$   
두번째 테스트의 집합에는 35점이 부여되어 있습니다:   
$0\lt B\le 2,000,000,000$   
$1\le P\le 30,000$   
세번째 테스트의 집합에는 30점이 부여되어 있습니다:   
$B=0$   
$1\le P\le 400000$   
# 입력
프로그램은 표준 입력에서 다음 데이터를 읽어야 합니다.   
   
1행에는 각각 M과 N을 나타내는 단일 공백으로 구분된 두 개의 정수가 포함되어 있습니다.   
두 번째 줄에는 감당할 수 있는 최대 비용(예: 예산)인 정수 B가 포함됩니다.   
3행에는 조사에서 발견된 장애물의 수인 정수 P가 포함됩니다.   
다음 P 라인 각각은 장애물을 설명합니다. 이 선 중 i번째는 i번째 장애물을 나타냅니다.   
각 줄은 단일 공백으로 구분된 5개의 정수 $(X_{i1}, Y_{i1}, X_{i2}, Y_{i2},C_i)$로 구성됩니다.   
이는 각각 장애물의 가장 왼쪽 셀의 좌표, 장애물의 가장 오른쪽 셀의 좌표,   
장애물 제거 비용을 나타냅니다. 그리드의 맨 아래 가장 왼쪽 셀에는 좌표 (1, 1)가 있고   
맨 위 맨 오른쪽 셀에는 좌표 (M, N)가 있습니다.    
# 출력
준비할 수 있는 피라미드 밑면의 가능한 측면 길이의 최대값을 포함하는
하나의 정수를 출력하십시오.
피라미드의 건축이 불가능한 경우 프로그램은 숫자 0을 출력해야 합니다. 
## 예제

### 예제 입력 1
```
6 9 
42 
5 
4 1 6 3 12 
3 6 5 6 9 
1 3 3 8 24 
3 8 6 9 21 
5 1 6 2 20 
```
### 예제 출력 1
```
4
```
### 설명
해당 그림은 변의 길이가 4로 가능한 두 개의 피라미드 기반의 위치를 보여주고 있습니다.  
### 예제 입력 2
```
13 5 
0 
8 
8 4 10 4 1 
4 3 4 4 1 
10 2 12 2 2 
8 2 8 4 3 
2 4 6 4 5 
10 3 10 4 8 
12 3 12 4 13 
2 2 4 2 21 
```
### 예제 출력 2
```
3
```
### 설명
해당 그림은 변의 길이가 3으로 가능한 유일한 피라미드 기반의 위치를 보여주고 있습니다.
+ ## Subtask 1. ( $35점$)
그 어떤 장애물도 제거할 수 없는 케이스입니다.
잘 생각해보면, 가능한 가장 큰 피라미드들은 적어도 좌우중 한 쪽이 장애물, 혹은 
전체 공간의 가장자리와 접해있고 이는 위 아래에 대해서도 마찬가지임을 알 수 있습니다. 이 성질을
자명하게 적용하면 가능한 모든 왼쪽, 오른쪽, 위, 아래에 대해서 가능한 최대 정사각형을 판별하는
문제가 되기 때문에 $O(P^3)$정도의 시간복잡도를 가지게 됩니다.
조금 더 생각해보면, 결정문제를 통해 해당 문제를 조금 더 빠르게 풀 수 있습니다.
기본적으로 길이 l이 되는 정사각형이 존재한다면 그보다 작은 길이의 정사각형도 존재하기 때문입니다.
또한, 길이 l의 정사각형이 존재한다는 것을 다르게 표현하면, 현재 존재하는 모든 장애물들을
왼쪽, 아래쪽으로 l만큼 늘린 새로운 문제에서 빈 공간이 존재하는지로 치환할 수 있습니다.
빈 공간이 존재하는지를 판별하는 문제는 충분히 빠른 시간 내에 쉽게 해결될 수 있기 때문에,
전체 문제도 충분히 빠르게 해결할 수 있습니다.
+ ## Subtask 3. ( $86점$)
우선, 만약 $Y_i$가 굉장히 크다면, 이때는 단순히 subtask 1,2의 풀이를 바로 적용해서 $O(n+m)$정도에 문제를 해결할 수 있습니다. $Y_i$가 굉장히 큰 쿼리들에 대해 잠시 생각해보면, 그러한 쿼리들은 그렇게 많지 않다는 사실을 알 수 있습니다. 만약 $t \le Y_i$일때 $Y_i$가 "굉장히 크다"라고 한다면, 그러한 쿼리의 개수는 $Q/t$를 절대 넘을 수 없고, 따라서 이 종류의 쿼리들을 처리하는데에 드는 시간은 $O((n+m)*Q/t)$가 됩니다.   
 이제 남은 것은 $Y_i$가 충분히 작은 쿼리들입니다. 여기에서 해야하는 관찰은, 파티가 주최되는 정점으로 갈 수 있는 최대 경로의 길이를 구하는 문제는, 그래프의 방향을 완벽히 뒤집은 다음 파티가 주최되는 정점에서 도달할 수 있는 모든 정점들에 대해 그 경로의 최댓값을 구하는 문제로 바꿀 수 있다는 사실입니다. 물론, subtask 1,2의 풀이처럼 최댓값만 저장해둔다면 최댓값이 되는 정점이 바쁜 정점일 가능성이 있기 때문에 통하지 않음을 알 수 있습니다.   
 그렇다면, 만약 하나의 정점에서 갈 수 있는 정점들을 경로가 긴 순으로 $t+1$개 들고 있는 상황이라면 어떨까요? 무조건 DAG이기 때문에 자식노드들로부터 병합을 하는 것도 가능하고, 설령 해당 정점에서 알아낸 $t+1$개의 정점들중 $t$개가 다르다고 하더라도, 남아있는 나머지 하나의 정점이 최대 길이라는 사실을 자명하게 알 수 있습니다. 어떤 노드에서 두 자식노드를 융합하는데에 걸리는 시간복잡도는 두 수열을 merge하는 아이디어처럼 구현한다면 $O(t)$가 되고, 간선은 m개이기 때문에 총 시간복잡도는 $O(t(m+n))$정도가 됩니다. 하나의 쿼리를 처리하기 위해서는 역시 적절한 처리를 통해 어떤 정점이 들고 있는 $t+1$개의 정점들중 제외되는 것들을 전부 빼낸 뒤 그중 최댓값을 찾으면 되는데, 이 또한 $O(t)$에 해결할 수 있습니다.   
 결과적으로, 전체 문제를 $(O(t(m+n)+(m+n)*Q/t))$만에 해결할 수 있는데, 이는 $t=sqrt(Q)$로 둘 경우 $O((m+n)sqrt(Q))$가 되어 문제를 해결하기에 충분해집니다.
