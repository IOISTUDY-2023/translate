# Rope

## 문제

아기 JOI 군은 밧줄을 가지고 놀고 있다. 밧줄의 길이는 $N$이고, 좌우로 곧게 뻗어 있다. 밧줄은 굵기 $1$, 길이 $1$의 끈 $N$개가 연결되어 구성된다. 밧줄에는 $M$종류의 색이 사용되어 있고, 왼쪽에서 $i$번째 끈의 색은 $C_{i} (1 \leq C_{i} \leq M)$이다.

JOI 군은 밧줄을 합쳐서 더 짧게 만드려고 한다. 구체적으로, 밧줄의 길이가 $2$가 될 때까지 다음과 같은 작업을 반복한다.

* 밧줄의 길이를 $L$이라 하자. 어떤 정수 $j(1 \leq j < L)$에 대해 왼쪽에서 길이 $j$의 위치가 새로운 끝점이 되도록 밧줄을 합친다. 즉,

  - $j \leq L / 2$일 때 각 $i(1 \leq i \leq j)$에 대해 왼쪽에서 $i$번쨰 끈과 왼쪽에서 $2j - i + 1$번째 끈을 합친다. 이때 원래 오른쪽 끝점이었던 위치는 계속 오른쪽 끝점이고, 줄의 길이는 $L - j$가 된다.
  
  - $j > L / 2$일 때 각 $i(2j - L + 1 \leq i \leq j)$에 대해 왼쪽에서 $i$번째 끈과 왼쪽에서 $2j-i+1$번째 끈을 합친다. 이때 원래 왼쪽 끝점이었던 위치는 오른쪽 끝점이 되고, 줄의 길이는 $j$가 된다.

* 이 때, 합쳐지는 각 끈 쌍에 대해 색을 맞춰야 한다. 밧줄은 합치기 전에 임의의 색으로 칠할 수 있지만, 칠할 때 그 굵기만큼의 비용이 발생한다. 색을 맞춘 후, 끈은 합쳐지고, 그 굵기는 합쳐진 두 끈의 굵기의 합이 된다.

JOI 군은 밧줄의 길이가 $2$가 될 때까지 작업 비용의 합을 최소화하고 싶어한다. JOI 군은 모든 색에 대해 최종적으로 밧줄이 그 색을 포함하도록 작업을 했을 때 작업 비용의 합의 최솟값을 구하고 싶어 한다.

여러분이 JOI 군을 대신하여 이 문제를 해결하자.

## 입력

표준 입력으로 다음 내용이 주어진다.

* 첫째 줄에는 두 개의 정수 $N, M$이 공백을 사이에 두고 주어진다. 이는 줄을 구성하는 끈 $N$개가 있고, 거기에 사용된 색의 종류가 $M$종류임을 의미한다.

* 둘째 줄에는 $N$개의 정수 $C_{1}, \cdots C_{N}$이 공백을 사이에 두고 주어진다. 이는 왼쪽에서 $i$번째 끈의 색이 $C_{i}$임을 의미한다.

## 출력

표준 출력으로 $M$줄을 출력한다. $M$줄 중 $c(1 \le c \le M)$번째 줄에는 최종적인 밧줄의 길이가 $2$가 되고, 그 밧줄이 색 $c$를 포함하도록 하게 하기 위한 비용의 합의 최솟값을 한 줄에 출력한다.

## 제한

모든 입력 데이터는 다음 조건을 만족한다.

* $2 \leq N \leq 1000000$
* $1 \leq M \leq M$
* $1 \leq C_{i} \leq M(1 \leq i \leq N)$
* $1 \leq c \leq M$을 만족하는 모든 정수 $c$에 대해, $C_{i}=c$인 $i$가 존재한다.

## 서브태스크

1. 서브태스크 1(15점)

* $N \leq 15$

* $M \leq 10$

2. 서브태스크 2(30점)

* $N \leq 100000$

* $M \leq 10$

3. 서브태스크 3(10점)

* $N \leq 100000$

* $M \leq 500$

4. 서브태스크 4(25점)

* $M \leq 5000$

5. 서브태스크 5(20점)

추가 제한이 없다.

# 해설

## 고찰

사용하는 두 가지 색을 고정했을 때, 최종적으로 각 끈은 밧줄의 왼쪽 또는 오른쪽에 속하게 되므로 최종적으로 두 가지 색 중 하나로 칠해져야 한다. 칠하는 비용이 그 끈의 굵기와 같으므로, 모든 끈을 처음에 칠하고 시작한다고 생각해도 무방하다.

사용할 색을 고정했을 때, 칠하는 방법은 $2^{N}$가지이지만, 그 경우의 수가 모두 밧줄의 길이를 $2$로 만들 수 있는 조합은 아니다. 초기 상태에서 밧줄의 각 끈의 $N + 1$가지 끝점이 최종 상태에서 어디에 위치하는지 생각해보면, 길이가 2가 된 밧줄의 끝점과 그 중간 지점을 교대로 지남을 알 수 있다.

따라서 모든 홀수 번째 끈이 반드시 그 직전의 짝수 번째 끈과 같은 색이거나 모든 짝수 번째 끈이 반드시 그 직전의 홀수 번째 끈과 같은 색이어야 한다. 역으로 이 조건 둘 중 하나를 만족하면 최종적인 길이가 $2$가 되게 할 수 있다.

## 서브태스크 1

최종 상태에서의 길이 $2$인 밧줄이 어떤 색 조합을 가질지 $M^2$가지 경우의 수가 있다. 모든 홀수 번째 끈이 그 직전의 짝수 번째 끈과 색이 같거나 모든 짝수 번째 끈이 그 직전의 홀수 번째 끈과 색이 같아야 하므로, 색을 칠하는 방법은 $2^{\frac{N}{2}}$가지이다.

따라서 $O(2^{\frac{N}{2}}M^{2})$가지 조합을 모두 시도해보면 되어 서브태스크 1을 해결할 수 있다.

## 서브태스크 2

사실 색의 조합을 결정하고 나면, $2^{\frac{N}{2}}$가지의 모든 색 조합을 시도할 필요는 없다.

모든 짝수 번째 끈이 그 직전의 홀수 번째 끈과 색이 같아야 하는 상황에서 생각해 보자. 그러면 $(1, 2), (3, 4), (5, 6) \cdots$ 각 쌍에 대해 색이 같아야 한다. 이때, 각 쌍에 대한 비용은 독립적이므로 각 쌍에 대해 두 색 중 어느 쪽을 선택하는 것의 비용이 더 적은지를 선택하여 그 색으로 칠하기만을 반복하면 된다. 모든 홀수 번째 끈이 그 직전의 짝수 번째 끈과 색이 같은 상황도 마찬가지이다.

따라서 각 색 조합에 대해 $O(N)$에 최적의 색칠 비용을 구할 수 있고, 전체 문제를 $O(NM^{2})$에 해결할 수 있다.

## 서브태스크 3

구해야 하는 것은 $M^2$가지 모든 색 조합에 대한 최소 비용이 아니라, 각 $M$가지 색이 포함되는 최종 상태에 대한 최소 비용이다.

어떤 색 $c$에 대해서 끈 쌍의 초기 색 조합은 다음과 같이 분류할 수 있다.

* 두 색이 모두 $c$
  이 경우 새로 색을 칠할 필요가 없다.
  
* 하나의 색은 $c$, 하나의 색은 다른 색
  이 경우 적어도 하나의 색을 새로 칠해야 하므로, $c$가 아닌 색을 $c$로 칠하는 데 1의 비용을 사용하면 된다.
  
* 두 색 모두 $c$가 아닌 색
  이 경우 $c$로 변화시키려면 반드시 2의 비용이 필요하므로, 다른 색으로 칠하는 편이 비용이 작거나 같다.

즉, 두 색 모두 $c$가 아닌 색인 경우만 $c$가 아닌 다른 하나의 색으로 칠하는 편이 낫다. 이것은 두 색 모두 $c$가 아닌 경우에 대해 각 색이 등장한 횟수를 세고, 그 중 최빈값의 색으로 그러한 쌍을 모두 칠하는 것이 최적이다. 최빈값을 구하는 것은 단순히 각 색이 등장한 횟수를 관리하면 $O(N+M)$에 가능하다.

$M$가지 색에 대하여 이 과정을 반복하면 되므로, 전체 시간복잡도는 $O(M(N+M))$이다.

## 서브태스크 5

서브태스크 3의 풀이에서 최빈값을 더 빠르게 구할 수 있다. 각 색의 개수와 개수의 개수를 관리하는 배열을 두고, 색 $c$가 바뀜에 따라 이 배열을 적절히 갱신하며 최빈값을 구할 수 있다.

각 끈의 색에 대한 정보는 한 번 추가되고 한 번 삭제되므로 시간복잡도는 $O(N)$이다.
