# Fences

## 문제

Mr. JOI는 IOI 도시에 아주 많은 땅을 소유하고 있다. IOI 도시는 2차원의 직교좌표계로 나타낼 수가 있으며, $X$-좌표가 $x$이고 $Y$-좌표가 $y$인 점을 $(x,y)$로 나타낸다. Mr. JOI의 땅은 $X$-좌표와 $Y$-좌표가 $-10^{100}$ 이상 $10^{100}$ 이하인 영역이다. 그는 그곳에서 소를 키우는 목장을 운영하고 있고, 목장은 $X$-좌표와 $Y$-좌표가 $-S$ 이상 $S$ 이하인 영역이다.

Mr. JOI는 소들을 지키기 위해 목장을 울타리를 이용하여 둘러쌀려고 한다. 하나의 울타리는 길이가 양의 실수인 하나의 선분으로 나타내어진다. Mr.JOI는 목장 내부의 어떠한 점에서도 자신의 땅을 나갈때 울타리를 하나도 만나지 않고 나갈 수 있는 방법이 존재하지 않도록 목장을 둘러쌀 것이다. 이미 그의 땅에는 몇개의 울타리가 설치되어 있으며, 목장을 둘러쌀때 이를 이용해도 된다. 이미 설치된 어떤 두 울타리가 만난다면, 만나 점은 두 울타리의 끝점 중 하나이다.

Mr. JOI는 원하는 만큼의 울타를 설치할 수 있다. 설치하는 울타리는 임의의 길이의 임의의 방향을 가르킬 수 있지만, 땅의 밖이나 목장의 안을 지나가면 안된다. 하지만 목장의 경계에 닿게는 설치할 수 있다. 또한, 길이가 $l$ $(l>0)$인 울타리를 새로 설치하는데에는 비용 $l$이 든다. 그리고 두 울타리가 교차하거나, 두 울타리 끝점을 공유하거나, 한 울타리의 끝점이 다른 울타리 위에 올라가게 울타리를 설치할 수 있다.

Mr. JOI는 최소한의 비용으로 목장을 둘러싸고 싶다.

목장의 크기와 이미 설치된 울타리의 정보가 주어졌을 때, 목장을 둘러싸기 위해 필요한 최소비용을 구하는 프로그램을 만들어라.

## 입력

첫 번째 줄에는 공백으로 구분된 두 정수 $N$과 $S$가 주어진다. 이는 목장이 $X$-좌표와 $Y$-좌표가 $-S$ 이상, $S$ 이하이고, Mr. JOI의 땅에 이미 $N$개의 울타가 설치되었다는 뜻이다.

다음 $N$개의 줄의 $i$번째 줄에는 $(1 \leq i \leq N)$ 공백으로 구분되는 4개의 정수 $A_i$, $B_i$, $C_i$, 그리고 $D_i$가 주어진다. 이는 이미 설치된 $i$번째 울타리는 두 점 $(A_i,B_i)$ 그리고 $(C_i,D_i)$를 잇는 선분이라는 뜻이다.

## 출력

첫 번째 줄에  목장을 둘러싸기 위한 최소비용을 출력한다. 소숫점은 원하는 만큼 출력해도 되지만, 출력값과 정답과의 오차는 최대 0.01이어야 한다.

## 제한

* $1 \leq N \leq 100$.
* $1 \leq S \leq 200$.
* $−200 \leq Ai \leq 200$ $(1 \leq i \leq N)$.
* $−200 \leq Bi \leq 200$ $(1 \leq i \leq N)$.
* $−200 \leq Ci \leq 200$ $(1 \leq i \leq N)$.
* $−200 \leq Di \leq 200$ $(1 \leq i \leq N)$.
* $(A_i,B_i)$, $(C_i,D_i)$ $(1 \leq i \leq N)$.
* 입력으로 주어지는 어떠한 울타리도 목장의 내부(경계 미포함)를 지나지 않는다.
* 입력으로 주어지는 임의의 서로 다른 두 울타리에 대해, 만약 만난다면 만나는 점은 두 울타리의 끝점임이 보장된다.

## 서브태스크

### 서브태스크 1 (18점)

$N = 1$

### 서브태스크 2 (33점)

$N \leq 6$

### 서브태스크 3 (49점)

추가적인 제한이 없다.

## 예제 입출력 1

### 예제 입력 1

3 4

-3 5 1 8

-4 3 -4 6

5 1 7 2

### 예제 출력 1

29.0000000000

예제 입력 1에서 이미 만들어진 울타리는 아래 그림의 왼쪽에 나타나 있다. 중심에 점선으로 나타나있는 것은 목장의 경계이다.

이 예제 입력에서 목장을 둘러쌀 수 있는 방법은 오른쪽에 나타나 있으며, 얇은 선이 새로 설치된 울타리를 나타낸다. 새로운 울타리를 설치하는데 드는 비용은 29이며, 이는 가능한 최소비용이다. 이 예제 입력에서, 29.0000000000 대신에 29나 28.999 같은 출력들도 정답으로 처리된다.

![Sample pic][sample]

## 예제 입출력 2

### 예제 입력 2

1 2

-3 -3 -3 -2

### 예제 출력 2

16.0000000000

이미 설치된 울타리를 하나도 안 써도 상관없다.

## 예제 입출력 3

### 예제 입력 3

4 3

4 -1 3 4

-4 2 -2 4

-4 0 -5 6

0 -6 5 -2

### 예제 출력 3

14.1392801789

## 예제 입출력 4

### 예제 입력 4

10 80

175 95 60 -146

-106 57 18 185

190 -68 177 -142

84 -195 127 -179

34 143 126 69

-92 133 -190 80

-157 -66 -119 -161

-85 -124 129 -171

141 181 175 175

107 -38 150 148

### 예제 출력 4

238.4778364511

[sample]: https://cdn.discordapp.com/attachments/939736755471532032/1095644900248268930/fences.png

# Fences Solution

최종적으로 완성되는 울타리의 각 꼭짓점은 주어진 울타리의 끝점이나 각 울타리의 끝점에서 다른 울타리에 내린 수선의 발이 될 것이다. 이 점을 이용하면 주어진 모든 점들을 이용하여 다른 점, 혹은 울타리에 수선의 발이랑 이어 그래프를 만들 수 있을 것이다. 그렇다면 구하고자 하는 답은 이 그래프에서 목장을 둘러싸는 가장 짧은 사이클의 길이가 된다.

### 그래프

앞에서 이야기한 것처럼 주어진 점들을 이용하여 그래프를 만들자. 우선 각 점들은 자신과 이어진 다른 점까지는 가중치 0인 간선으로 이어줄 수 있다. 또한 가운데 정사각형의 목장을 침범하면 안되므로 목장의 각 변도 가중치 $2 * C$인 간선으로 이어줄 수 있다.

주어진 점들을 이용하여 그래프를 만들자. 하나의 점과 하나의 울타리에 대하여 간선을 이을때는 가중치를 이 둘 사이에 최단거리로 설정해야 한다. 최단거리의 후보로는 점에서 울타리의 양 끝점까지의 거리, 그리고 수선의 발까지의 거리가 있다(만약 수선의 발이 울타리 밖이라면 이 거리를 사용할 수 없다). 이 3가지 중 어떤 것을 사용해야 되는지를 판단한 후, 간선으로 이어주면 된다. 이때 설치하는 울타리는 목장 내부를 통과하면 안되므로 목장의 4변과 교차하는지 확인해야 한다.

예외적으로 목장의 변과 이을 때는 항상 목장을 교차하게 되므로 이때는 따로 처리하면 된다.

이런식으로 그래프를 만들었으면 플로이드-워셜 등을 이용하여 최소 가중치를 가지는 사이클을 $O(N^3)$에 구할 수 있다. 하지만 여기까지만 하면 울타리가 목장을 둘러싸지 않을 수가 있다.

### 목장을 둘러싸는지 확인

어떠한 사이클을 찾았을 때, 이 사이클이 목장을 전부 둘러싸는지 확인해야 한다. 어떤 점이 어떤 다각형 내부에 있는지 확인하기 위해서는 그 점에서 반직선을 그어 다각형과의 교점의 수를 세면 된다. 이를 이용하여 조건을 만족 시키는지 확인할 수가 있다.

목장 내부의 점을 하나 정한 후, 이 점에서 시작하는 반직선을 하나 정하자. 만약 고른 사이클이 이 반직선과 짝수번 교차하면 울타리는 목장을 둘러싸지 못한거고, 홀수번이면 목장을 둘러싼 것이다. 그래프를 만드는 파트에서 간선을 이을때, 가중치뿐만 아니라 이 반직선과의 교차 여부도 같이 저장하자. 이후 사이클을 구할때마다 구한 사이클의 간선 중 반직선과 교차하는 간선의 개수를 세서 설치한 울타리가 목장을 둘러싸는지에 대한 여부를 알 수가 있다.
